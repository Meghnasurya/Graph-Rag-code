{% extends "base.html" %}

{% block title %}Dashboard - Agentic RAG System{% endblock %}

{% block content %}
<div class="container-fluid py-4">
    <!-- Header Section -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card-modern p-4">
                <div class="row align-items-center">
                    <div class="col-md-8">
                        <h2 class="mb-2">
                            <i class="fas fa-tachometer-alt me-2 text-primary"></i>
                            Dashboard
                        </h2>
                        <p class="text-muted mb-0">
                            Generate intelligent test cases using AI-powered analysis of your codebase and requirements.
                        </p>
                    </div>
                    <div class="col-md-4 text-md-end">
                        <div class="d-flex gap-2 justify-content-md-end flex-wrap">
                            <span class="status-indicator status-connected" id="github-status">
                                <i class="fab fa-github me-1"></i>
                                <span id="github-text">GitHub Connected</span>
                            </span>
                            <span class="status-indicator status-connected" id="jira-status">
                                <i class="fab fa-atlassian me-1"></i>
                                <span id="jira-text">Jira Connected</span>
                            </span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Connection Status -->
    <div class="row mb-4" id="connection-alerts">
        {% if not session.get('github_token') %}
        <div class="col-12">
            <div class="alert alert-warning">
                <i class="fas fa-exclamation-triangle me-2"></i>
                <strong>GitHub not connected.</strong> 
                <a href="{{ url_for('github_auth') }}" class="alert-link">Connect your GitHub account</a> to access repositories.
            </div>
        </div>
        {% endif %}
        
        {% if not session.get('jira_token') %}
        <div class="col-12">
            <div class="alert alert-warning">
                <i class="fas fa-exclamation-triangle me-2"></i>
                <strong>Jira not connected.</strong> 
                <a href="{{ url_for('jira_auth') }}" class="alert-link">Connect your Jira account</a> to manage test cases.
            </div>
        </div>
        {% endif %}
    </div>

    <!-- Query Interface -->
    {% if session.get('github_token') and session.get('jira_token') %}
    <div class="row mb-4">
        <div class="col-12">
            <div class="query-container">
                <h4 class="mb-3">
                    <i class="fas fa-search me-2 text-primary"></i>
                    Test Generation Query
                </h4>
                <form id="queryForm">
                    <div class="mb-3">
                        <label for="queryInput" class="form-label fw-semibold">
                            Describe your testing requirements:
                        </label>
                        <textarea 
                            class="form-control" 
                            id="queryInput" 
                            name="query"
                            rows="4" 
                            placeholder="Example: Create unit tests for user authentication functionality including password validation, session management, and error handling..."
                            required
                        ></textarea>
                        <div class="form-text">
                            <i class="fas fa-lightbulb me-1"></i>
                            Be specific about the functionality you want to test. The AI will analyze your codebase and generate appropriate test cases.
                        </div>
                    </div>
                    
                    <div class="d-flex gap-2 align-items-center">
                        <button type="submit" class="btn btn-primary btn-lg">
                            <i class="fas fa-magic me-2"></i>
                            Generate Tests
                        </button>
                        <button type="button" class="btn btn-outline-secondary" id="clearQuery">
                            <i class="fas fa-eraser me-1"></i>
                            Clear
                        </button>
                        <div class="ms-auto">
                            <small class="text-muted">
                                <i class="fas fa-info-circle me-1"></i>
                                Tests will be created/updated in your selected Jira project
                            </small>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
    {% endif %}

    <!-- Loading State -->
    <div class="row mb-4" id="loading-section" style="display: none;">
        <div class="col-12">
            <div class="card-modern p-4 text-center">
                <div class="spinner-border text-primary mb-3" role="status">
                    <span class="visually-hidden">Loading...</span>
                </div>
                <h5>Analyzing Requirements & Generating Tests...</h5>
                <p class="text-muted mb-0">
                    <span id="loading-text">Processing your request...</span>
                </p>
            </div>
        </div>
    </div>

    <!-- Results Section -->
    <div class="row" id="results-section" style="display: none;">
        <div class="col-12">
            <div class="card-modern">
                <div class="card-header">
                    <h5 class="mb-0">
                        <i class="fas fa-check-circle me-2 text-success"></i>
                        Test Generation Results
                    </h5>
                </div>
                <div class="card-body" id="results-content">
                    <!-- Results will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Quick Actions -->
    <div class="row mb-4">
        <div class="col-12">
            <h5 class="mb-3">
                <i class="fas fa-bolt me-2 text-warning"></i>
                Quick Actions
            </h5>
        </div>
        <div class="col-md-4 mb-3">
            <div class="action-card">
                <div class="action-icon">
                    <i class="fab fa-github"></i>
                </div>
                <h6>Repository Selection</h6>
                <p>Choose and analyze your GitHub repositories</p>
                <a href="{{ url_for('select_repo') }}" class="btn btn-outline-primary btn-sm">
                    <i class="fas fa-cog me-1"></i>
                    Manage Repos
                </a>
            </div>
        </div>
        <div class="col-md-4 mb-3">
            <div class="action-card">
                <div class="action-icon">
                    <i class="fab fa-atlassian"></i>
                </div>
                <h6>Project Management</h6>
                <p>Configure your Jira projects and test management</p>
                <a href="{{ url_for('select_project') }}" class="btn btn-outline-primary btn-sm">
                    <i class="fas fa-tasks me-1"></i>
                    Manage Projects
                </a>
            </div>
        </div>
        <div class="col-md-4 mb-3">
            <div class="action-card">
                <div class="action-icon">
                    <i class="fas fa-chart-line"></i>
                </div>
                <h6>System Status</h6>
                <p>View embeddings, collections, and system health</p>
                <button class="btn btn-outline-primary btn-sm" onclick="checkStatus()">
                    <i class="fas fa-heartbeat me-1"></i>
                    Check Status
                </button>
            </div>
        </div>
    </div>

    <!-- System Status -->
    <div class="row" id="status-section" style="display: none;">
        <div class="col-12">
            <div class="card-modern">
                <div class="card-header">
                    <h5 class="mb-0">
                        <i class="fas fa-server me-2 text-info"></i>
                        System Status
                    </h5>
                </div>
                <div class="card-body" id="status-content">
                    <!-- Status will be populated here -->
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const queryForm = document.getElementById('queryForm');
    const queryInput = document.getElementById('queryInput');
    const loadingSection = document.getElementById('loading-section');
    const resultsSection = document.getElementById('results-section');
    const resultsContent = document.getElementById('results-content');
    const clearButton = document.getElementById('clearQuery');

    // Auto-check status on page load
    checkStatus();

    // Handle form submission
    if (queryForm) {
        queryForm.addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const query = queryInput.value.trim();
            if (!query) return;

            // Show loading state
            loadingSection.style.display = 'block';
            resultsSection.style.display = 'none';
            
            // Update loading text
            const loadingTexts = [
                'Analyzing your repository...',
                'Searching existing documentation...',
                'Reviewing current test coverage...',
                'Generating new test cases...',
                'Updating Jira test repository...'
            ];
            
            let textIndex = 0;
            const loadingTextElement = document.getElementById('loading-text');
            const loadingInterval = setInterval(() => {
                loadingTextElement.textContent = loadingTexts[textIndex];
                textIndex = (textIndex + 1) % loadingTexts.length;
            }, 2000);

            try {
                const formData = new FormData();
                formData.append('query', query);

                const response = await fetch('/query', {
                    method: 'POST',
                    body: formData
                });

                const result = await response.json();
                
                clearInterval(loadingInterval);
                loadingSection.style.display = 'none';
                
                if (result.error) {
                    showError(result.error);
                } else {
                    showResults(result);
                }
                
            } catch (error) {
                clearInterval(loadingInterval);
                loadingSection.style.display = 'none';
                showError('Failed to process query: ' + error.message);
            }
        });
    }

    // Clear query
    if (clearButton) {
        clearButton.addEventListener('click', function() {
            queryInput.value = '';
            resultsSection.style.display = 'none';
        });
    }

    function showResults(result) {
        let html = '<div class="row">';
        
        // Analysis section
        if (result.analysis) {
            html += `
                <div class="col-md-6 mb-3">
                    <div class="result-card">
                        <h6><i class="fas fa-analytics me-2"></i>Analysis</h6>
                        <ul class="list-unstyled mb-0">
                            <li><strong>Existing functionality:</strong> ${result.analysis.existing_functionality ? 'Yes' : 'No'}</li>
                            <li><strong>Existing tests:</strong> ${result.analysis.existing_tests ? 'Yes' : 'No'}</li>
                            <li><strong>Needs new tests:</strong> ${result.analysis.needs_new_tests ? 'Yes' : 'No'}</li>
                            <li><strong>Needs test updates:</strong> ${result.analysis.needs_test_updates ? 'Yes' : 'No'}</li>
                        </ul>
                    </div>
                </div>
            `;
        }

        // Generated tests section
        if (result.generated_tests) {
            html += `
                <div class="col-md-6 mb-3">
                    <div class="result-card">
                        <h6><i class="fas fa-code me-2"></i>Generated Tests</h6>
                        <p><strong>File:</strong> ${result.generated_tests.file_name || 'N/A'}</p>
                        <p><strong>Test Cases:</strong> ${result.generated_tests.test_cases ? result.generated_tests.test_cases.length : 0}</p>
                        <div class="mt-2">
                            <button class="btn btn-sm btn-outline-primary" onclick="showTestDetails(${JSON.stringify(result.generated_tests).replace(/"/g, '&quot;')})">
                                <i class="fas fa-eye me-1"></i>View Details
                            </button>
                        </div>
                    </div>
                </div>
            `;
        }

        html += '</div>';

        // Success message
        if (result.updated_embeddings) {
            html += `
                <div class="alert alert-success mt-3">
                    <i class="fas fa-check-circle me-2"></i>
                    <strong>Success!</strong> Tests have been generated and your Jira project has been updated.
                </div>
            `;
        }

        // Existing tests message
        if (result.message) {
            html += `
                <div class="alert alert-info mt-3">
                    <i class="fas fa-info-circle me-2"></i>
                    ${result.message}
                </div>
            `;
        }

        resultsContent.innerHTML = html;
        resultsSection.style.display = 'block';
    }

    function showError(error) {
        resultsContent.innerHTML = `
            <div class="alert alert-danger">
                <i class="fas fa-exclamation-triangle me-2"></i>
                <strong>Error:</strong> ${error}
            </div>
        `;
        resultsSection.style.display = 'block';
    }
});

function showTestDetails(testData) {
    let html = '<div class="modal fade" id="testDetailsModal" tabindex="-1"><div class="modal-dialog modal-lg"><div class="modal-content">';
    html += '<div class="modal-header"><h5 class="modal-title">Test Details</h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div>';
    html += '<div class="modal-body">';
    
    if (testData.test_cases) {
        html += '<h6>Test Cases:</h6><div class="accordion" id="testCasesAccordion">';
        testData.test_cases.forEach((tc, index) => {
            html += `
                <div class="accordion-item">
                    <h2 class="accordion-header">
                        <button class="accordion-button ${index > 0 ? 'collapsed' : ''}" type="button" data-bs-toggle="collapse" data-bs-target="#collapse${index}">
                            ${tc.name || `Test Case ${index + 1}`}
                        </button>
                    </h2>
                    <div id="collapse${index}" class="accordion-collapse collapse ${index === 0 ? 'show' : ''}" data-bs-parent="#testCasesAccordion">
                        <div class="accordion-body">
                            <p><strong>Description:</strong> ${tc.description || 'N/A'}</p>
                            ${tc.steps ? `<p><strong>Steps:</strong></p><ol>${tc.steps.map(step => `<li>${step}</li>`).join('')}</ol>` : ''}
                            <p><strong>Expected Result:</strong> ${tc.expected_result || 'N/A'}</p>
                        </div>
                    </div>
                </div>
            `;
        });
        html += '</div>';
    }
    
    if (testData.test_code) {
        html += '<h6 class="mt-3">Generated Code:</h6>';
        html += `<pre class="bg-light p-3 rounded"><code>${testData.test_code}</code></pre>`;
    }
    
    html += '</div><div class="modal-footer"><button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button></div></div></div></div>';
    
    // Remove existing modal if any
    const existingModal = document.getElementById('testDetailsModal');
    if (existingModal) {
        existingModal.remove();
    }
    
    // Add new modal
    document.body.insertAdjacentHTML('beforeend', html);
    
    // Show modal
    const modal = new bootstrap.Modal(document.getElementById('testDetailsModal'));
    modal.show();
}

async function checkStatus() {
    try {
        const response = await fetch('/status');
        const status = await response.json();
        
        // Update status indicators
        updateStatusIndicator('github-status', 'github-text', status.github_connected, 'GitHub');
        updateStatusIndicator('jira-status', 'jira-text', status.jira_connected, 'Jira');
        
        // Show detailed status
        const statusContent = document.getElementById('status-content');
        statusContent.innerHTML = `
            <div class="row">
                <div class="col-md-6">
                    <h6>Connection Status</h6>
                    <ul class="list-unstyled">
                        <li><i class="fas fa-circle ${status.github_connected ? 'text-success' : 'text-danger'} me-2"></i>GitHub: ${status.github_connected ? 'Connected' : 'Not Connected'}</li>
                        <li><i class="fas fa-circle ${status.jira_connected ? 'text-success' : 'text-danger'} me-2"></i>Jira: ${status.jira_connected ? 'Connected' : 'Not Connected'}</li>
                        <li><i class="fas fa-circle ${status.repo_selected ? 'text-success' : 'text-warning'} me-2"></i>Repository: ${status.repo_selected ? 'Selected' : 'Not Selected'}</li>
                        <li><i class="fas fa-circle ${status.project_selected ? 'text-success' : 'text-warning'} me-2"></i>Project: ${status.project_selected ? 'Selected' : 'Not Selected'}</li>
                    </ul>
                </div>
                <div class="col-md-6">
                    <h6>Collections Status</h6>
                    <ul class="list-unstyled">
                        <li><i class="fas fa-database me-2 text-info"></i>Documentation: ${status.collections_info?.docs_count || 0} embeddings</li>
                        <li><i class="fas fa-database me-2 text-info"></i>Tests: ${status.collections_info?.tests_count || 0} embeddings</li>
                    </ul>
                    <small class="text-muted">Last updated: ${new Date(status.timestamp).toLocaleString()}</small>
                </div>
            </div>
        `;
        
        document.getElementById('status-section').style.display = 'block';
        
    } catch (error) {
        console.error('Failed to check status:', error);
    }
}

function updateStatusIndicator(elementId, textId, connected, service) {
    const element = document.getElementById(elementId);
    const textElement = document.getElementById(textId);
    
    if (element && textElement) {
        element.className = `status-indicator ${connected ? 'status-connected' : 'status-disconnected'}`;
        textElement.textContent = `${service} ${connected ? 'Connected' : 'Disconnected'}`;
    }
}
</script>
{% endblock %}
                        <textarea 
                            class="form-control query-input" 
                            id="queryInput" 
                            name="query" 
                            placeholder="Example: I need tests for user authentication with multi-factor authentication, including edge cases for invalid credentials and session management..."
                            required>
                        </textarea>
                    </div>
                    <div class="d-flex gap-2">
                        <button type="submit" class="btn btn-gradient-primary btn-lg" id="generateBtn">
                            <i class="fas fa-magic me-2"></i>
                            Generate Tests
                        </button>
                        <button type="button" class="btn btn-outline-secondary btn-lg" id="clearBtn">
                            <i class="fas fa-eraser me-2"></i>
                            Clear
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Loading State -->
    <div class="row mb-4" id="loadingSection" style="display: none;">
        <div class="col-12">
            <div class="card-modern p-4 text-center">
                <div class="d-flex align-items-center justify-content-center mb-3">
                    <div class="loading-spinner me-3"></div>
                    <h5 class="mb-0">Analyzing your requirements<span class="loading-dots"></span></h5>
                </div>
                <p class="text-muted mb-0">
                    AI is processing your codebase and generating intelligent test cases...
                </p>
            </div>
        </div>
    </div>

    <!-- Results Section -->
    <div class="row" id="resultsSection" style="display: none;">
        <!-- Analysis Results -->
        <div class="col-lg-6 mb-4">
            <div class="result-card">
                <div class="result-header">
                    <div class="result-icon" style="background: var(--gradient-primary);">
                        <i class="fas fa-analytics"></i>
                    </div>
                    <div>
                        <h5 class="mb-1">Analysis Results</h5>
                        <p class="text-muted mb-0">AI analysis of existing tests and requirements</p>
                    </div>
                </div>
                <div id="analysisContent">
                    <!-- Analysis content will be populated here -->
                </div>
            </div>
        </div>

        <!-- Generated Tests -->
        <div class="col-lg-6 mb-4">
            <div class="result-card">
                <div class="result-header">
                    <div class="result-icon" style="background: var(--gradient-success);">
                        <i class="fas fa-code"></i>
                    </div>
                    <div>
                        <h5 class="mb-1">Generated Test Cases</h5>
                        <p class="text-muted mb-0">Automatically generated test code and cases</p>
                    </div>
                </div>
                <div id="testContent">
                    <!-- Test content will be populated here -->
                </div>
            </div>
        </div>

        <!-- Jira Integration -->
        <div class="col-12 mb-4">
            <div class="result-card">
                <div class="result-header">
                    <div class="result-icon" style="background: var(--gradient-secondary);">
                        <i class="fab fa-atlassian"></i>
                    </div>
                    <div>
                        <h5 class="mb-1">Jira Integration</h5>
                        <p class="text-muted mb-0">Test cases created/updated in your Jira project</p>
                    </div>
                </div>
                <div id="jiraContent">
                    <!-- Jira content will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Quick Actions -->
    <div class="row">
        <div class="col-12">
            <div class="card-modern p-4">
                <h5 class="mb-3">
                    <i class="fas fa-bolt me-2 text-warning"></i>
                    Quick Actions
                </h5>
                <div class="row g-3">
                    <div class="col-md-3">
                        <a href="{{ url_for('select_repo') }}" class="btn btn-outline-primary w-100">
                            <i class="fab fa-github me-2"></i>
                            Change Repository
                        </a>
                    </div>
                    <div class="col-md-3">
                        <a href="{{ url_for('select_project') }}" class="btn btn-outline-secondary w-100">
                            <i class="fab fa-atlassian me-2"></i>
                            Change Project
                        </a>
                    </div>
                    <div class="col-md-3">
                        <a href="{{ url_for('status') }}" class="btn btn-outline-info w-100">
                            <i class="fas fa-info-circle me-2"></i>
                            System Status
                        </a>
                    </div>
                    <div class="col-md-3">
                        <button class="btn btn-outline-success w-100" onclick="location.reload()">
                            <i class="fas fa-sync-alt me-2"></i>
                            Refresh
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const queryForm = document.getElementById('queryForm');
    const queryInput = document.getElementById('queryInput');
    const generateBtn = document.getElementById('generateBtn');
    const clearBtn = document.getElementById('clearBtn');
    const loadingSection = document.getElementById('loadingSection');
    const resultsSection = document.getElementById('resultsSection');

    // Form submission
    queryForm.addEventListener('submit', async function(e) {
        e.preventDefault();
        
        const query = queryInput.value.trim();
        if (!query) {
            alert('Please enter your testing requirements.');
            return;
        }

        // Show loading state
        loadingSection.style.display = 'block';
        resultsSection.style.display = 'none';
        generateBtn.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>Generating...';
        generateBtn.disabled = true;

        try {
            const formData = new FormData();
            formData.append('query', query);

            const response = await fetch('/query', {
                method: 'POST',
                body: formData
            });

            const result = await response.json();

            // Hide loading state
            loadingSection.style.display = 'none';
            generateBtn.innerHTML = '<i class="fas fa-magic me-2"></i>Generate Tests';
            generateBtn.disabled = false;

            if (result.error) {
                throw new Error(result.error);
            }

            // Display results
            displayResults(result);
            resultsSection.style.display = 'block';

        } catch (error) {
            console.error('Error:', error);
            loadingSection.style.display = 'none';
            generateBtn.innerHTML = '<i class="fas fa-magic me-2"></i>Generate Tests';
            generateBtn.disabled = false;
            
            alert('Error generating tests: ' + error.message);
        }
    });

    // Clear button
    clearBtn.addEventListener('click', function() {
        queryInput.value = '';
        resultsSection.style.display = 'none';
        queryInput.focus();
    });

    function displayResults(result) {
        // Display analysis
        const analysisContent = document.getElementById('analysisContent');
        if (result.analysis) {
            analysisContent.innerHTML = `
                <div class="mb-3">
                    <h6><i class="fas fa-search me-2"></i>Requirements Analysis</h6>
                    <div class="row g-2">
                        <div class="col-6">
                            <div class="badge ${result.analysis.existing_functionality ? 'bg-success' : 'bg-secondary'} w-100">
                                <i class="fas fa-${result.analysis.existing_functionality ? 'check' : 'times'} me-1"></i>
                                Existing Functionality
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="badge ${result.analysis.existing_tests ? 'bg-success' : 'bg-secondary'} w-100">
                                <i class="fas fa-${result.analysis.existing_tests ? 'check' : 'times'} me-1"></i>
                                Existing Tests
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="badge ${result.analysis.needs_new_tests ? 'bg-warning' : 'bg-secondary'} w-100">
                                <i class="fas fa-${result.analysis.needs_new_tests ? 'plus' : 'check'} me-1"></i>
                                New Tests Needed
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="badge ${result.analysis.needs_test_updates ? 'bg-info' : 'bg-secondary'} w-100">
                                <i class="fas fa-${result.analysis.needs_test_updates ? 'edit' : 'check'} me-1"></i>
                                Updates Needed
                            </div>
                        </div>
                    </div>
                </div>
                <div>
                    <h6><i class="fas fa-lightbulb me-2"></i>Recommendations</h6>
                    <ul class="list-unstyled">
                        ${result.analysis.recommendations?.map(rec => 
                            `<li><i class="fas fa-arrow-right me-2 text-primary"></i>${rec}</li>`
                        ).join('') || '<li class="text-muted">No specific recommendations</li>'}
                    </ul>
                </div>
            `;
        }

        // Display generated tests
        const testContent = document.getElementById('testContent');
        if (result.generated_tests) {
            const tests = result.generated_tests;
            testContent.innerHTML = `
                <div class="mb-3">
                    <h6><i class="fas fa-file-code me-2"></i>${tests.file_name || 'Generated Test File'}</h6>
                    <div class="result-code">
                        <pre><code>${tests.test_code || 'No test code generated'}</code></pre>
                    </div>
                </div>
                <div>
                    <h6><i class="fas fa-list me-2"></i>Test Cases (${tests.test_cases?.length || 0})</h6>
                    ${tests.test_cases?.map((tc, index) => `
                        <div class="card mb-2">
                            <div class="card-body p-3">
                                <h6 class="card-title">${tc.name}</h6>
                                <p class="card-text text-muted">${tc.description}</p>
                                ${tc.steps ? `
                                    <div class="mb-2">
                                        <strong>Steps:</strong>
                                        <ol class="mb-0">
                                            ${tc.steps.map(step => `<li>${step}</li>`).join('')}
                                        </ol>
                                    </div>
                                ` : ''}
                                ${tc.expected_result ? `
                                    <div>
                                        <strong>Expected Result:</strong> ${tc.expected_result}
                                    </div>
                                ` : ''}
                            </div>
                        </div>
                    `).join('') || '<p class="text-muted">No test cases generated</p>'}
                </div>
            `;
        }

        // Display Jira integration status
        const jiraContent = document.getElementById('jiraContent');
        jiraContent.innerHTML = `
            <div class="alert alert-success" role="alert">
                <i class="fas fa-check-circle me-2"></i>
                Test cases have been automatically created/updated in your Jira project.
            </div>
        `;
    }

    // Auto-resize textarea
    queryInput.addEventListener('input', function() {
        this.style.height = 'auto';
        this.style.height = this.scrollHeight + 'px';
    });
});
</script>
{% endblock %}
